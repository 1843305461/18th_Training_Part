## Week 5

说明：本文档主要是将晦涩难懂的官方语言尽量解释成大家可以理解的知识，但这也意味着这种解释是片面的，所以大家在观看完本文档后，应该对TIM，UART等功能有大体的认识，在基于这种认识之上，再去学习官方对于各种功能的解释，就会比较好理解了。所以要求大家在观看完本文档后，开始自学，在网络上查找本周涉及到的相关知识，比如CSDN，有很多大佬写的博客，但这些博客对于新手来说确实有一些难懂，所以要求大家观看完本文档，在CSDN（或其他平台）上查找相关知识，进一步的学习。同时学明白原理之后，也要明白代码如何配置相关功能，大家可以参考**正点原子**，**野火**等相关例程。

### 高级TIM

在上周大家已经了解了定时器的初级功能，比如定时器中断，计数。在这周大家会学习定时器其他功能。![](C:\Users\lenovo\Pictures\Saved Pictures\20200508202457535.png)

在了解定时器的功能之前，大家先了解一下定时器的原理，定时器就是每隔设定的时间增1，你可以通过设定定时器的频率来设定定时器增1的周期，比如设定2000Hz，就是1秒钟计两千次。计的数是储存在叫TIMx_CNT寄存器中的，这个寄存器的大小是16位或32位，也就是计数器计数的最大值是65535，当计数计满后会发生溢出事件（当然这个计数计满的值也可以人为设定，可以触发中断/DMA），自动从重装载值开始重新计数。如何设定定时器的频率，这就涉及到另一个寄存器TIMx_PSC，这个寄存器可以设置定时器频率的预分频系数。定时器频率=72MHZ/(时钟预分频+1)，溢出时间=(时钟预分频+1)\* (TIM_Period（上文计数器计满的值）+1)/72MHZ。或者你可以不设定计数器计满的值，也可以设定计数器计数的初始值（通过重装载寄存器），或者两个都设定。目的都是设定定时器计数多少触发溢出事件。

#### 输入捕获

字面意思上就是捕获输入信号，所以它捕获的就是定时器对应通道的上升沿或者下降沿，它将通道出现上升沿时刻，当时定时器的计数值存储到对应的通道的捕获/比较寄存器（TIMx_CCRx）里面，完成一次捕获，并且可以触发中断。

#### 输出比较

我们既然可以记录通道输入信号的时间，也可以通过时间控制通道的输出，我们使用这个功能最重要的就是让单片机输出PWM波，我们使用PWM作为控制信号来使用，一般来调节它的占空比来进行电机，舵机的控制，那么什么是PWM波呢，PWM波最重要的参数就是频率（frequency），占空比（duty），下图就是PWM波的波形，那么它与方波有什么区别呢，

![](C:\Users\lenovo\Pictures\Saved Pictures\20200127210316749.png)

频率很好理解，作为一个周期信号，f=1/T。那么占空比是什么呢，占空比就是**高电平的时间与整个周期时间的比例**，